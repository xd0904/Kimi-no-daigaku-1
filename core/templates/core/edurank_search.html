<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduRank - 특성화고 입시 정보 (Mock Data 모드)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }
        /* 검색 결과가 없을 때를 위한 스타일 */
        .no-results {
            display: none; /* 평소엔 숨김 */
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="mb-8 bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
            <h1 class="text-3xl font-bold text-blue-700">특성화고 특별전형 입시 정보</h1>
            <p class="text-gray-600 mt-1">조회하고 싶은 대학이나 학과를 검색해 보세요.</p>
            
            <form id="searchForm" class="flex flex-col sm:flex-row gap-3 mt-6">
                <input type="text" id="universitySearch" class="form-input w-full sm:w-1/3 p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="대학명 (예: 서울대학교)">
                <input type="text" id="departmentSearch" class="form-input w-full sm:w-1/3 p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="학과명 (예: 컴퓨터공학과)">
                <button type="submit" id="searchButton" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 w-full sm:w-auto">
                    검색
                </button>
            </form>
        </header>

        <main class="grid grid-cols-1 gap-8">
            <section class="space-y-6"> 
                <h2 class="text-2xl font-semibold text-gray-800">검색 결과</h2>
                <div id="resultsContainer" class="space-y-6">
                </div>
                <div id="noResultsMessage" class="no-results text-center bg-white p-10 rounded-lg shadow-sm border border-gray-200">
                    <p class="text-gray-500 text-lg">검색 결과가 없습니다.</p>
                    <p class="text-gray-400 mt-2">대학명이나 학과명을 입력하고 검색해 보세요.</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- Mock Data (API 응답 시뮬레이션 - API 실패 시 임시 사용) ---
        const mockData = [
            {
                "id": 1,
                "university": "서울대학교",
                "division": "자연계열",
                "department": "컴퓨터공학과",
                "recruitment_group": "가군",
                "standards": ["기준학과 3 (컴퓨터)", "기준학과 2 (전자)"],
                "scoring": {
                    "korean": 200, "math": 200, "inquiry": 200,
                    "english_method": "감점",
                    "english_table": "1등급: 0, 2등급: -1, 3등급: -3",
                    "school_record": 100
                },
                "results": [
                    {
                        "year": 2024, "quota": 3,
                        "korean_grade": 1.5, "korean_percentile": 98,
                        "math_grade": 1.2, "math_percentile": 99,
                        "english_grade": 1,
                        "inquiry_grade": 1.8, "inquiry_percentile": 97
                    },
                    {
                        "year": 2023, "quota": 3,
                        "korean_grade": 1.6, "korean_percentile": 97,
                        "math_grade": 1.3, "math_percentile": 99,
                        "english_grade": 1,
                        "inquiry_grade": 1.9, "inquiry_percentile": 96
                    }
                ]
            },
            {
                "id": 2,
                "university": "고려대학교",
                "division": "인문계열",
                "department": "경영학과",
                "recruitment_group": "나군",
                "standards": ["기준학과 5 (회계)", "기준학과 3 (컴퓨터)"],
                "scoring": {
                    "korean": 250, "math": 200, "inquiry": 150,
                    "english_method": "가산점",
                    "english_table": "1등급: 100, 2등급: 98",
                    "school_record": 0
                },
                "results": [
                    {
                        "year": 2024, "quota": 5,
                        "korean_grade": 1.8, "korean_percentile": 96,
                        "math_grade": 2.0, "math_percentile": 95,
                        "english_grade": 1,
                        "inquiry_grade": 2.1, "inquiry_percentile": 94
                    }
                ]
            },
            {
                "id": 3,
                "university": "연세대학교",
                "division": "자연계열",
                "department": "기계공학과",
                "recruitment_group": "가군",
                "standards": ["기준학과 1 (기계)"],
                "scoring": {
                    "korean": 200, "math": 300, "inquiry": 200,
                    "english_method": "가산점",
                    "english_table": "1등급: 100, 2등급: 95",
                    "school_record": 50
                },
                "results": [
                    {
                        "year": 2024, "quota": 2,
                        "korean_grade": 2.1, "korean_percentile": 94,
                        "math_grade": 1.9, "math_percentile": 96,
                        "english_grade": 2,
                        "inquiry_grade": 2.3, "inquiry_percentile": 93
                    },
                    {
                        "year": 2023, "quota": 2,
                        "korean_grade": 2.2, "korean_percentile": 93,
                        "math_grade": 2.0, "math_percentile": 95,
                        "english_grade": 1,
                        "inquiry_grade": 2.4, "inquiry_percentile": 92
                    }
                ]
            }
        ];

        // --- DOM 요소 가져오기 ---
        const searchForm = document.getElementById('searchForm');
        const universityInput = document.getElementById('universitySearch');
        const departmentInput = document.getElementById('departmentSearch');
        const resultsContainer = document.getElementById('resultsContainer');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const searchButton = document.getElementById('searchButton');

        // --- 이벤트 리스너 ---
        searchForm.addEventListener('submit', function(event) {
            event.preventDefault(); // 폼 제출 기본 동작 방지
            handleSearch();
        });

        // --- 함수 정의 ---

        // 1. 검색 처리 함수 (Mock Data 사용 로직 유지, 실제 API 실패 시만 사용됨)
        async function handleSearch() {
            const univQuery = universityInput.value.trim();
            const deptQuery = departmentInput.value.trim();
            let allData = [];

            // 검색 버튼 비활성화 및 텍스트 변경 (로딩 표시)
            searchButton.disabled = true;
            searchButton.textContent = '검색 중...';

            // TODO: 친구가 만든 API 엔드포인트 URL로 교체해야 합니다.
            const API_ENDPOINT = '/api/search/';
            
            const url = `${API_ENDPOINT}?university=${encodeURIComponent(univQuery)}&department=${encodeURIComponent(deptQuery)}`;

            try {
                // 실제 API 호출 로직 (이 부분이 성공하면 실제 데이터가 나옴)
                const response = await fetch(url);

                if (!response.ok) {
                    // HTTP 상태 코드가 200 (OK)이 아니면 에러를 발생시킵니다.
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                allData = await response.json();
                
            } catch (error) {
                console.error("API 호출 중 오류 발생. 임시 Mock Data를 사용합니다:", error);
                
                // API 서버 연결 실패 시, mockData에서 검색어에 맞는 데이터를 필터링하여 사용합니다.
                allData = mockData.filter(item => {
                    // 검색어가 비어 있으면 모든 데이터를 반환합니다.
                    if (!univQuery && !deptQuery) return true;
                    
                    const univMatch = item.university.includes(univQuery);
                    const deptMatch = item.department.includes(deptQuery);
                    return univMatch && deptMatch;
                });
            } finally {
                // 검색 버튼 재활성화 및 텍스트 복구
                searchButton.disabled = false;
                searchButton.textContent = '검색';

                displayResults(allData);
            }
        }

        // 2. 검색 결과 표시 함수 (레이아웃 수정)
        function displayResults(data) {
            resultsContainer.innerHTML = ''; // 이전 결과 초기화

            if (data.length === 0) {
                noResultsMessage.style.display = 'block'; // 결과 없음 메시지 표시
                return;
            }
            
            noResultsMessage.style.display = 'none'; // 결과 있음 메시지 숨김

            // ⭐️ 1단계 중복 제거: 대학명-학과명으로 항목 1개만 남김 (결과 카드 중복 제거) ⭐️
            const uniqueDataMap = new Map();
            data.forEach(item => {
                const key = `${item.university}-${item.department}`; 
                
                if (!uniqueDataMap.has(key)) {
                    uniqueDataMap.set(key, item);
                }
            });

            const uniqueData = Array.from(uniqueDataMap.values());
            // ⭐️ 1단계 중복 제거 로직 끝 ⭐️


            uniqueData.forEach(item => { // 중복이 제거된 uniqueData를 사용합니다.
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-xl shadow-md border border-gray-200 transition-shadow duration-300 hover:shadow-lg';
                
                // 학과/대학 정보
                let html = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-blue-700">${item.department}</h3>
                            <p class="text-gray-600">${item.university} | ${item.division}</p>
                        </div>
                        <span class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">${item.recruitment_group}</span>
                    </div>
                `;

                // 지원 가능 기준학과
                html += `
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-700 mb-1">지원 가능 기준학과</h4>
                        <div class="flex flex-wrap gap-2">
                            ${item.standards.map(std => `<span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-md">${std}</span>`).join('')}
                        </div>
                    </div>
                `;

                // 입결 정보 (Admission Results)
                html += `<h4 class="font-semibold text-gray-700 mb-2">최근 입시 결과</h4>`;
                
                // ⭐️ 2단계 중복 제거: results 배열 내에서 연도(year)별로 항목 1개만 남김 ⭐️
                const uniqueResultsMap = new Map();
                item.results.forEach(result => {
                    // 연도(year)를 기준으로 고유성 판단
                    if (!uniqueResultsMap.has(result.year)) {
                        uniqueResultsMap.set(result.year, result);
                    }
                });
                
                // 연도 내림차순 정렬 (최신 연도가 위로 오도록)
                const uniqueResults = Array.from(uniqueResultsMap.values()).sort((a, b) => b.year - a.year);

                // ⭐️ 2단계 중복 제거 로직 끝 ⭐️


                uniqueResults.forEach(result => {
                    // ⚠️ 수정된 부분: dt와 dd의 너비(w-1/4, w-3/4)를 제거하여 공간을 줄였습니다. ⚠️
                    html += `
                        <div class="border-t border-gray-200 pt-3 mt-3">
                            <p class="font-semibold text-gray-600">${result.year} 학년도 (모집인원: ${result.quota}명)</p>
                            <dl class="grid grid-cols-2 gap-x-4 gap-y-1 text-sm mt-2">
                                <div class="flex justify-between">
                                    <dt class="text-gray-500">국어</dt>
                                    <dd class="text-gray-800 text-right">등급 ${result.korean_grade} (백분위 ${result.korean_percentile})</dd>
                                </div>
                                <div class="flex justify-between">
                                    <dt class="text-gray-500">수학</dt>
                                    <dd class="text-gray-800 text-right">등급 ${result.math_grade} (백분위 ${result.math_percentile})</dd>
                                </div>
                                <div class="flex justify-between">
                                    <dt class="text-gray-500">탐구</dt>
                                    <dd class="text-gray-800 text-right">등급 ${result.inquiry_grade} (백분위 ${result.inquiry_percentile})</dd>
                                </div>
                                <div class="flex justify-between">
                                    <dt class="text-gray-500">영어</dt>
                                    <dd class="text-gray-800 text-right">등급 ${result.english_grade}</dd>
                                </div>
                            </dl>
                        </div>
                    `;
                });

                card.innerHTML = html;
                resultsContainer.appendChild(card);
            });
        }

        // 3. 초기 화면 설정 함수 
        function initializeDisplay() {
            resultsContainer.innerHTML = '';
            // 초기에는 검색 필드가 비어있으면 전체 Mock Data를 표시합니다.
            displayResults(mockData);
        }

        // --- 초기 로드 ---
        initializeDisplay();
    </script>

</body>
</html>